<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.css">
    <script src="/js/jquery-3.1.1.min.js"></script>    
    <script src="../bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="../js/xlsx.core.min.js"></script>
    <style>
        .container{
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="tree-list">
                <ul class="tree-1">
                    <li class="">
                        <div><span class="glyphicon glyphicon-triangle-bottom"> </span>资产模型</div>
                        <ul class="tree-2">
                            <li class="">
                                <div><span class="glyphicon glyphicon-list-alt"></span>灯集中控制器</div>
                            </li>
                            <li>
                                <div><span class="glyphicon glyphicon-lamp"></span>LED灯</div>
                            </li>
                            <li class="active">
                                <div><span class="glyphicon glyphicon-sort"></span>PLC回路控制器</div>
                            </li>
                            <li>
                                <div><span class="glyphicon glyphicon-modal-window"></span>智慧电表</div>
                            </li>
                            <li>
                                <div><span class="glyphicon glyphicon-flag"></span>灯杆</div>
                            </li>
                            <li>
                                <div><span class="glyphicon glyphicon-phone"></span>广告屏</div>
                            </li>
                            <li>
                                <div><span class="glyhicon glyphicon-object-align-horizontal"></span>数据采集仪</div>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div><span class="glyphicon glyphicon-triangle-right"></span>资产统计</div>
                    </li>
                </ul>
            </div>
        </div>
        <input type="file" id="excel-file">
    </div>
    <script>
        $('#excel-file').change(function(e) {
            var files = e.target.files;

            var fileReader = new FileReader();

            // 以二进制方式打开文件
            fileReader.readAsBinaryString(files[0]);

            fileReader.onload = function(ev) {
                
                try {
                    var data = ev.target.result,
                        workbook = XLSX.read(data, {
                            type: 'binary'
                        }), // 以二进制流方式读取得到整份excel表格对象
                        persons = []; // 存储获取到的数据
                } catch (e) {
                    console.log('文件类型不正确');
                    return;
                }

                // 表格的表格范围，可用于判断表头是否数量是否正确
                var fromTo = '';
                // 遍历每张表读取
                for (var sheet in workbook.Sheets) {
                    if (workbook.Sheets.hasOwnProperty(sheet)) {
                        fromTo = workbook.Sheets[sheet]['!ref'];
                        console.log(fromTo);
                        persons = persons.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet]));
                        // break; // 如果只取第一张表，就取消注释这行
                    }
                }

                // console.log(persons);
                var headStr = '姓名,性别,年龄,学校';
                for (var i = 0; i < persons.length; i++) {
                    if (Object.keys(persons[i]).join(',') !== headStr) {
                        persons.splice(i, 1);
                    }
                }

                console.log(persons);
            };
            
        });
    </script>
</body>
</html>